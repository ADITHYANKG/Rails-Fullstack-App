<% if user_signed_in? %>
  <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 mt-10">Your Cart</h1>

  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 min-h-screen">
    
    <!-- Stimulus Controller Applied Here -->
    <div data-controller="cart" class="bg-white shadow-lg rounded-lg p-6">
      <!-- Cart Items -->
      <div class="mt-4" data-cart-target="cartTop">
        <div id="cart-items" class="mt-4 space-y-6">
          <!-- Example Item Structure (To be dynamically generated by Stimulus) -->
          <div class="flex items-center border-b pb-4">
            <img src="https://via.placeholder.com/80" alt="Product Image" class="w-20 h-20 object-contain rounded-lg">
            <div class="ml-4 flex-1">
              <h3 class="font-semibold text-lg">Product Name</h3>
              <p class="text-gray-600 text-sm">Rs.1000</p>
            </div>
            <button class="ml-auto text-red-500 hover:text-red-700 transition">Remove</button>
          </div>
          <!-- End Example Item -->
        </div>
      </div>
      <!-- Total Amount -->
      <div class="mt-6 font-medium text-xl text-gray-800" data-cart-target="cartMid">
        <div id="headname"></div>
        <br>
        <div id="cart-total-amount" class="font-bold">Total: Rs.0.00</div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-4 flex flex-wrap gap-3" data-cart-target="checkBot">
        <button class="py-2 px-6 bg-gray-900 hover:bg-gray-800 text-white rounded-md transition"
          data-action="click->cart#checkout" >
          Checkout
        </button>
        <button class="py-2 px-6 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition"
          data-action="click->cart#clear">
          Clear Cart
        </button>
      </div>

      <!-- Checkout Form (Initially Hidden) -->
      <div id="checkout-form" class="hidden mt-6 p-6 border rounded-lg shadow-lg bg-white" data-cart-target="checkoutForm">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Checkout</h2>
        <form id="order-form" data-action="submit->cart#placeOrder" class="space-y-4">
          
          <div>
            <label class="block text-gray-700 font-semibold">Email:</label>
            <input type="email" id="email" name="email" class="w-full p-3 border rounded-md focus:ring-2 focus:ring-gray-800" required>
          </div>

          <div>
            <label class="block text-gray-700 font-semibold">Address:</label>
            <textarea id="address" name="address" class="w-full p-3 border rounded-md focus:ring-2 focus:ring-gray-800" required></textarea>
          </div>

          <!-- Dummy Payment Section -->
          <div>
            <label class="block text-gray-700 font-semibold">Payment:</label>
            <select id="payment-method" name="payment_method" class="w-full p-3 border rounded-md focus:ring-2 focus:ring-gray-800">
              <option value="demo">Demo Payment</option>
            </select>
          </div>

          <button type="submit" class="w-full py-3 px-6 bg-green-600 hover:bg-green-700 text-white rounded-md transition">
            Place Order
          </button>
        </form>
      </div>
    </div>
  </div>

<% else %>
  <h2 class="text-2xl text-center text-gray-900 mt-10">Please log in to view your cart.</h2>
<% end %>
